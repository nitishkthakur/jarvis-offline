# Copilot Instructions for Jarvis Offline Project

## Project Overview
This is the Jarvis Offline project - an AI agent system built with Python that uses Ollama for local LLM inference and various tools for enhanced functionality.

## Key Components

### 1. OllamaClient (`ollama_client.py`)
- Main agent class for interacting with Ollama API
- Supports conversation history, system instructions, and tool integration
- Features:
  - Agent naming and role management
  - Conversation context from other agents
  - JSON schema support for structured responses
  - Streaming and non-streaming responses
  - Tool/function calling capabilities

### 2. Tools (`tools.py`)
- Contains utility functions and external API integrations
- Currently includes:
  - `tavily_search()`: Web search using Tavily API with XML-formatted results
  - Environment variable loading with python-dotenv

## Coding Guidelines

### Code Style
- Use type hints for all function parameters and return values
- Follow PEP 8 naming conventions
- Include comprehensive docstrings with Args and Returns sections
- Use descriptive variable and function names

### Error Handling
- Implement proper exception handling for external API calls
- Return meaningful error messages in XML format for tools
- Use timeouts for network requests (default: 30 seconds)

### Agent System Patterns
- Each agent should have a unique name and role
- Use conversation history for context continuity
- System instructions should remain separate from agent context
- Tool results should be captured and included in agent context

### Tool Development
- Tools should return string responses
- Use XML tags for structured output (`<chunk 1>`, `<error>`, etc.)
- Include metadata in tool responses
- Validate input parameters and provide clear error messages

### Environment Management
- Use `.env` files for API keys and sensitive configuration
- Provide `.env.template` for easy setup
- Load environment variables at module level with python-dotenv

## Architecture Notes

### Agent Context Structure
```xml
<agent_name>
Task: This is the role_description
Agent Response: response_text
Tool(s) Invoked and the tool outputs obtained: {tool_name: result}
</agent_name>
```

### Conversation Flow
1. System instructions set agent personality
2. Conversation history maintains context
3. Agent context tracks specific agent actions
4. Tool results are integrated into responses

## Dependencies
- ollama: Local LLM inference
- requests: HTTP client for API calls
- pydantic: Data validation and JSON schema
- python-dotenv: Environment variable management

## Testing Approach
- Include test functions in `if __name__ == "__main__":` blocks
- Test error conditions and edge cases
- Verify API integration without requiring actual API keys in tests
- Use descriptive output for debugging

## Common Patterns

### Tool Function Template
```python
def tool_name(param1: str, param2: int = 5) -> str:
    """
    Brief description of what the tool does.
    
    Args:
        param1 (str): Description of parameter
        param2 (int): Description with default value
    
    Returns:
        str: Description of return value with XML format
    """
    try:
        # Implementation
        return "<chunk 1>Result</chunk 1>"
    except Exception as e:
        return f"<error>{str(e)}</error>"
```

### Agent Setup Pattern
```python
agent = OllamaClient(
    model_name="llama3.2:3b",
    system_instructions="You are a helpful assistant...",
    agent_name="AgentName"
)
agent.set_role("Specific role description")
```

## File Structure
```
jarvis-offline/
├── ollama_client.py    # Main agent implementation
├── tools.py           # Tool functions and utilities
├── .env.template      # Environment variable template
├── .env              # Actual environment variables (gitignored)
├── requirements.txt   # Python dependencies
└── README.md         # Project documentation
```

## When Adding New Features
1. Consider impact on existing conversation flows
2. Maintain backward compatibility where possible
3. Add appropriate type hints and documentation
4. Include error handling and validation
5. Update this instructions file if adding new patterns
